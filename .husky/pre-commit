#!/bin/sh
# Pre-commit hook for MaycoleTechnologies
# Runs linting and formatting checks before commit

echo "ğŸ” Running pre-commit checks..."

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Get the staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(tsx?|jsx?)$')

if [ -z "$STAGED_FILES" ]; then
  echo "${GREEN}âœ… No TypeScript/JavaScript files to check${NC}"
  exit 0
fi

echo "ğŸ“ Files to check:"
echo "$STAGED_FILES"

# Check formatting
echo ""
echo "${YELLOW}Checking code formatting...${NC}"
if npm run format:check > /dev/null 2>&1; then
  echo "${GREEN}âœ… Formatting check passed${NC}"
else
  echo "${YELLOW}âš ï¸ Formatting issues found, auto-fixing...${NC}"
  npm run format
  echo "${GREEN}âœ… Code formatted successfully${NC}"
  echo "${YELLOW}Please re-stage the formatted files${NC}"
  exit 1
fi

# Check linting
echo ""
echo "${YELLOW}Checking for lint errors...${NC}"
if npm run lint > /dev/null 2>&1; then
  echo "${GREEN}âœ… Linting check passed${NC}"
else
  echo "${YELLOW}âš ï¸ Linting errors found${NC}"
  npm run lint
  echo "${RED}âŒ Please fix linting errors before committing${NC}"
  exit 1
fi

# Check for console.log in production code
echo ""
echo "${YELLOW}Checking for console.log statements...${NC}"
if echo "$STAGED_FILES" | grep -v '\.test\.' | xargs grep -l "console\." 2>/dev/null; then
  echo "${YELLOW}âš ï¸ console.log found in staged files (excluding tests)${NC}"
  echo "${YELLOW}Consider removing for production code${NC}"
fi

# Check for debugger statements
echo ""
echo "${YELLOW}Checking for debugger statements...${NC}"
if echo "$STAGED_FILES" | xargs grep -l "debugger" 2>/dev/null; then
  echo "${RED}âŒ debugger statement found${NC}"
  exit 1
fi

echo ""
echo "${GREEN}âœ… All pre-commit checks passed!${NC}"
exit 0
