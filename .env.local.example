# MaycoleTechnologies™ - Environment Variables Configuration

## Quick Setup Instructions

### 1. Copy this file
```bash
cp .env.example .env.local
```

### 2. Fill in your Stripe API keys
Get these from: https://dashboard.stripe.com/apikeys

### 3. For local development only
Add to .env.local (never commit this file)

### 4. For Vercel deployment
Add to Vercel Dashboard → Settings → Environment Variables

---

# ===== STRIPE CONFIGURATION =====

## Stripe Test Keys (for development)
# Get from: https://dashboard.stripe.com/apikeys (View test data toggle ON)

# Publishable Key (safe to expose in frontend)
VITE_STRIPE_PUBLIC_KEY=pk_test_XXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Secret Key (NEVER expose in frontend - server-side only)
STRIPE_SECRET_KEY=sk_test_XXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Webhook Signing Secret (for verifying webhook events)
# Get from: https://dashboard.stripe.com/webhooks
STRIPE_WEBHOOK_SECRET=whsec_test_XXXXXXXXXXXXXXXXXXXXXXXXXX

## Stripe Product Price IDs
# Create these in Stripe Dashboard → Products
# For each pricing tier, you'll have separate monthly/yearly prices

# Professional Plan (Monthly) - $99/month
VITE_STRIPE_PRICE_PROFESSIONAL_MONTHLY=price_XXXXXXXXXXXXXXXXXXXX

# Professional Plan (Yearly) - $990/year (save 15%)
VITE_STRIPE_PRICE_PROFESSIONAL_YEARLY=price_XXXXXXXXXXXXXXXXXXXX

# Enterprise Plan (Monthly) - $299/month
VITE_STRIPE_PRICE_ENTERPRISE_MONTHLY=price_XXXXXXXXXXXXXXXXXXXX

# Enterprise Plan (Yearly) - $2,990/year (save 15%)
VITE_STRIPE_PRICE_ENTERPRISE_YEARLY=price_XXXXXXXXXXXXXXXXXXXX

## Stripe Product IDs (for reference)
VITE_STRIPE_PRODUCT_PROFESSIONAL=prod_1234567890abcdefghijk

VITE_STRIPE_PRODUCT_ENTERPRISE=prod_1234567890abcdefghijl

# ===== API CONFIGURATION =====

# API Base URL (for serverless functions)
VITE_API_BASE_URL=http://localhost:3000/api

# For Vercel deployment, use:
# VITE_API_BASE_URL=https://maycoletechnologies.com/api

# ===== DATABASE CONFIGURATION =====

# PostgreSQL connection string (from Vercel Postgres)
POSTGRES_URL=postgresql://user:password@host.vercel.postgres.com/dbname

# ===== EMAIL SERVICE (SendGrid) =====

# SendGrid API Key (for sending transactional emails)
# Get from: https://app.sendgrid.com/settings/api_keys
SENDGRID_API_KEY=SG.1234567890abcdefghijklmnopqrstuvwxyz

# SendGrid email sender (must be verified in SendGrid)
VITE_SENDGRID_FROM_EMAIL=noreply@maycoletechnologies.com

# ===== ERROR TRACKING (Sentry) =====

# Sentry DSN (for error tracking and monitoring)
# Get from: https://[org].sentry.io/settings/projects/[project]/keys/
VITE_SENTRY_DSN=https://abc123def456@xyz.ingest.sentry.io/123456

# ===== ANALYTICS & TRACKING =====

# Enable analytics collection
VITE_ENABLE_ANALYTICS=true

# Google Analytics Tracking ID
VITE_GA_TRACKING_ID=G-XXXXXXXXXX

# Enable click/event tracking
VITE_ENABLE_CLICK_TRACKING=true

# Enable payment event tracking
VITE_ENABLE_PAYMENT_TRACKING=true

# ===== APPLICATION CONFIGURATION =====

# Demo mode (disables real payments)
VITE_DEMO_MODE=false

# Contact email for support
VITE_CONTACT_EMAIL=help@maycoletechnologies.com

# JWT Secret (for authentication)
JWT_SECRET=your-super-secret-jwt-key-minimum-32-characters

# ===== FEATURE FLAGS =====

# Enable/disable payment processing
VITE_ENABLE_PAYMENTS=true

# Enable/disable lead capture
VITE_ENABLE_LEAD_CAPTURE=true

# Enable/disable newsletter signup
VITE_ENABLE_NEWSLETTER=true

# ===== SENTRY CONFIGURATION =====

# Sentry environment (development, staging, production)
VITE_SENTRY_ENVIRONMENT=development

# Enable debug mode in Sentry (local development only)
VITE_SENTRY_DEBUG=false

# Sentry sample rate (0.0 to 1.0, 1.0 = capture all)
VITE_SENTRY_SAMPLE_RATE=1.0

# Trace sample rate for performance monitoring
VITE_SENTRY_TRACE_SAMPLE_RATE=0.1

# ===== VERCEL DEPLOYMENT =====

# Vercel URL (auto-set by Vercel)
VERCEL_URL=maycoletechnologies.vercel.app

# Custom domain
NEXT_PUBLIC_DOMAIN=maycoletechnologies.com

# ===== SECURITY =====

# CORS allowed origins (comma-separated)
ALLOWED_ORIGINS=http://localhost:3000,https://maycoletechnologies.com

# Rate limiting
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW_MS=60000

# ===== DEVELOPMENT ONLY =====

# Enable verbose logging
VITE_DEBUG=false

# Enable source maps in production
VITE_SOURCE_MAPS=false

# Log all API calls
VITE_LOG_API_CALLS=false

---

## Setting Up in Different Environments

### Local Development (.env.local)

```bash
VITE_STRIPE_PUBLIC_KEY=pk_test_XXXX
STRIPE_SECRET_KEY=sk_test_XXXX
STRIPE_WEBHOOK_SECRET=whsec_test_XXXX
VITE_API_BASE_URL=http://localhost:3000/api
POSTGRES_URL=postgresql://localhost/maycoletechnologies
VITE_DEMO_MODE=false
JWT_SECRET=your-local-secret-key
```

### Vercel Staging

1. Go to Vercel Dashboard → Project → Settings → Environment Variables
2. Add these variables (use test Stripe keys):
   ```
   VITE_STRIPE_PUBLIC_KEY=pk_test_...
   STRIPE_SECRET_KEY=sk_test_...
   STRIPE_WEBHOOK_SECRET=whsec_test_...
   POSTGRES_URL=...
   JWT_SECRET=...
   SENDGRID_API_KEY=...
   VITE_SENTRY_DSN=...
   ```
3. Set "Environment" to "Staging"
4. Redeploy

### Vercel Production (Live Payments)

1. Complete Stripe verification (Account → Settings → Business Profile)
2. Switch Stripe API keys to LIVE:
   ```
   VITE_STRIPE_PUBLIC_KEY=pk_live_...
   STRIPE_SECRET_KEY=sk_live_...
   STRIPE_WEBHOOK_SECRET=whsec_live_...
   ```
3. Update Vercel environment variables
4. Update webhook endpoint in Stripe: https://maycoletechnologies.com/api/webhooks/stripe
5. Redeploy

---

## Stripe Dashboard Checklist

- [ ] Navigate to https://dashboard.stripe.com
- [ ] Click **"Developers"** in top navigation
- [ ] Click **"API Keys"**
- [ ] Toggle **"View test data"** (top right)
- [ ] Copy **Publishable Key** (pk_test_...) → VITE_STRIPE_PUBLIC_KEY
- [ ] Copy **Secret Key** (sk_test_...) → STRIPE_SECRET_KEY
- [ ] Go to **"Webhooks"** → **"+ Add endpoint"**
  - URL: http://localhost:3000/api/webhooks/stripe (local) or https://maycoletechnologies.com/api/webhooks/stripe (production)
  - Events: checkout.session.completed, charge.succeeded, charge.failed, etc.
  - Copy **Signing secret** → STRIPE_WEBHOOK_SECRET

---

## Creating Stripe Products

1. Stripe Dashboard → **Products** → **+ Add Product**
2. Create "Professional" product:
   - Price: $99/month (recurring)
   - Copy Price ID → VITE_STRIPE_PRICE_PROFESSIONAL_MONTHLY
3. Create "Enterprise" product:
   - Price: $299/month (recurring)
   - Copy Price ID → VITE_STRIPE_PRICE_ENTERPRISE_MONTHLY
4. Create yearly variants (optional)

---

## Testing Stripe Integration Locally

```bash
# 1. Start dev server
npm run dev

# 2. Go to http://localhost:3000
# 3. Click "Professional Plan" → "Subscribe"
# 4. Enter test card: 4242 4242 4242 4242
# 5. Expiry: 12/25, CVC: 123
# 6. Expected: Success page with session details

# 7. Check Stripe Dashboard → Payments
#    Payment should show with status "Succeeded"

# 8. Check database (Vercel Postgres)
#    Run: SELECT * FROM payments ORDER BY created_at DESC LIMIT 1;
#    Should show the test payment
```

---

## Troubleshooting

### "Stripe public key is undefined"
- [ ] .env.local file exists
- [ ] VITE_STRIPE_PUBLIC_KEY is set
- [ ] Key starts with `pk_test_` or `pk_live_`
- [ ] Restart dev server: `npm run dev`

### "Cannot POST /api/webhooks/stripe"
- [ ] API endpoint file exists: `api/webhooks/stripe.ts`
- [ ] STRIPE_WEBHOOK_SECRET is set in environment
- [ ] Webhook URL in Stripe matches your domain
- [ ] Check Vercel logs: `vercel logs`

### "Payment declined" in Stripe
- [ ] You're using test card: 4242 4242 4242 4242
- [ ] Expiry is future date: 12/25 or later
- [ ] You're in test mode (not live mode)

### "Webhook signature verification failed"
- [ ] STRIPE_WEBHOOK_SECRET is exact (no spaces, copy directly)
- [ ] Webhook is being sent to correct endpoint
- [ ] Endpoint is accessible (not localhost if deployed)

---

## Next Steps

1. **Create .env.local file**
   ```bash
   cp .env.example .env.local
   ```

2. **Add your Stripe test keys**
   - Get from https://dashboard.stripe.com/apikeys

3. **Create Stripe products**
   - Professional: $99/month
   - Enterprise: $299/month

4. **Create webhook endpoint**
   - URL: http://localhost:3000/api/webhooks/stripe
   - Select events

5. **Test locally**
   - npm run dev
   - Click "Subscribe"
   - Use test card 4242 4242 4242 4242

6. **Deploy to Vercel**
   - Add environment variables
   - Update webhook URL
   - Test with real card

7. **Go live**
   - Switch to live Stripe keys
   - Complete verification
   - Activate Stripe account

---

For more details, see:
- STRIPE_ACTIVATION_CHECKLIST.md
- STRIPE_LOGIN_STATUS.md
- INFRASTRUCTURE_SETUP_COMPLETE.md
- BACKEND_SETUP_GUIDE.md

